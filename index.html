<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Terra Dominus: Imperial Map</title>
    <script src="assets/icons.js"></script>
    <style>
        body { margin: 0; background: #020617; overflow: hidden; color: #f8fafc; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        #ui-overlay { position: absolute; top: 20px; left: 20px; pointer-events: none; }
        .stat-box { background: rgba(15, 23, 42, 0.9); padding: 12px 20px; border-radius: 12px; border: 1px solid #38bdf8; margin-bottom: 10px; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        #city-info { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: #1e293b; padding: 20px; border-radius: 24px; border: 2px solid #38bdf8; width: 85%; display: none; box-shadow: 0 -10px 40px rgba(0,0,0,0.5); text-align: center; }
        .btn-capture { width: 100%; margin-top: 15px; padding: 15px; border-radius: 12px; background: linear-gradient(135deg, #38bdf8, #0ea5e9); border: none; color: white; font-weight: bold; font-size: 1.1em; cursor: pointer; }
    </style>
</head>
<body>

<div id="ui-overlay">
    <div class="stat-box">üåç –°–¢–ê–¢–£–°: <span id="user-rank" style="color:#38bdf8">–ö–†–ï–°–¢–¨–Ø–ù–ò–ù</span></div>
    <div class="stat-box">üí∞ –ö–ê–ó–ù–ê: <span style="color:#10b981">0.00 USDT</span></div>
</div>

<div id="city-info">
    <div id="city-name" style="font-size: 1.4em; font-weight: bold; margin-bottom: 5px;">–ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞</div>
    <div id="city-owner" style="color: #94a3b8;">–í–ª–∞–¥–µ–ª–µ—Ü: –°–≤–æ–±–æ–¥–Ω–∞—è –∑–µ–º–ª—è</div>
    <button class="btn-capture" onclick="captureAction()">–ó–ê–•–í–ê–¢–ò–¢–¨ –ó–ê 10 USDT</button>
</div>

<canvas id="mapCanvas"></canvas>

<script>
    const canvas = document.getElementById('mapCanvas');
    const ctx = canvas.getContext('2d');
    const cityInfo = document.getElementById('city-info');

    let width, height;
    let hexSize = 50;
    let offset = { x: window.innerWidth/2, y: window.innerHeight/2 };
    let isDragging = false;
    let startMouse = { x: 0, y: 0 };

    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    const images = {};
    let loadedImages = 0;
    const totalImages = Object.keys(MAP_ICONS).length;

    for (let key in MAP_ICONS) {
        images[key] = new Image();
        images[key].src = MAP_ICONS[key];
        images[key].onload = () => {
            loadedImages++;
            if (loadedImages === totalImages) draw();
        };
    }

    const cities = [
        { x: 0, y: 0, name: "–°–¢–û–õ–ò–¶–ê –ú–ò–†–ê", type: "capital", owner: "Emperor" },
        { x: 2, y: -1, name: "–ó–æ–ª–æ—Ç—ã–µ –ü—Ä–∏–∏—Å–∫–∏", type: "mine", owner: "Lord-X" },
        { x: -2, y: 2, name: "–ó–∞–º–æ–∫ –¢–µ–Ω–µ–π", type: "city", owner: "None" },
        { x: 3, y: 3, name: "–ë–∞—à–Ω—è –°—Ç—Ä–∞–∂–∏", type: "tower", owner: "None" }
    ];

    function init() {
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
        draw();
    }

    function drawHex(x, y, size, color) {
        ctx.beginPath();
        for (let i = 0; i < 6; i++) {
            let angle = Math.PI / 3 * i;
            ctx.lineTo(x + size * Math.cos(angle), y + size * Math.sin(angle));
        }
        ctx.closePath();
        ctx.strokeStyle = color;
        ctx.stroke();
    }

    function draw() {
        ctx.clearRect(0, 0, width, height);
        const rowStep = hexSize * 1.5;
        const colStep = hexSize * Math.sqrt(3);

        for (let q = -5; q < 6; q++) {
            for (let r = -5; r < 6; r++) {
                let centerX = offset.x + colStep * (q + r/2);
                let centerY = offset.y + rowStep * r;

                if (centerX > -100 && centerX < width + 100 && centerY > -100 && centerY < height + 100) {
                    drawHex(centerX, centerY, hexSize - 2, "#1e293b");
                    
                    cities.forEach(city => {
                        if (city.x === q && city.y === r) {
                            const img = images[city.type];
                            const imgSize = hexSize * 1.2;
                            ctx.drawImage(img, centerX - imgSize/2, centerY - imgSize/2.5 - 15, imgSize, imgSize);
                            
                            ctx.fillStyle = "white";
                            ctx.font = "bold 12px Arial";
                            ctx.textAlign = "center";
                            ctx.fillText(city.name.toUpperCase(), centerX, centerY + 35);
                        }
                    });
                }
            }
        }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    canvas.addEventListener('mousedown', e => { isDragging = true; startMouse = { x: e.clientX - offset.x, y: e.clientY - offset.y }; });
    window.addEventListener('mouseup', () => isDragging = false);
    window.addEventListener('mousemove', e => {
        if (isDragging) {
            offset.x = e.clientX - startMouse.x;
            offset.y = e.clientY - startMouse.y;
            draw();
        }
    });

    canvas.addEventListener('click', (e) => {
        // –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –±–ª–∏–∂–∞–π—à–µ–≥–æ –≥–æ—Ä–æ–¥–∞ (–¥–ª—è –¥–µ–º–æ)
        cityInfo.style.display = 'block';
        document.getElementById('city-name').innerText = "–ù–û–í–ê–Ø –¢–ï–†–†–ò–¢–û–†–ò–Ø";
    });

    function captureAction() {
        alert("–ó–∞–ø—Ä–æ—Å –∫ —Å–º–∞—Ä—Ç-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û–∂–∏–¥–∞–Ω–∏–µ USDT...");
        cityInfo.style.display = 'none';
    }

    window.addEventListener('resize', init);
    init();
</script>
</body>
</html>
